<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Button Debug - BeeMazing</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background: #f5f5f5;
        }
        
        .debug-container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .step {
            margin: 20px 0;
            padding: 15px;
            border: 2px solid #ddd;
            border-radius: 5px;
            background: #f9f9f9;
        }
        
        .step.active {
            border-color: #FBB740;
            background: #fff8e1;
        }
        
        .step.success {
            border-color: #4caf50;
            background: #e8f5e8;
        }
        
        .step.error {
            border-color: #f44336;
            background: #ffebee;
        }
        
        .test-button {
            background: #FBB740;
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
            font-size: 16px;
        }
        
        .test-button:hover {
            background: #E6A42D;
        }
        
        .profile-icon {
            background: #FBB740;
            color: white;
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
        }
        
        .add-user-btn {
            background: #FBB740;
            color: white;
            border: none;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            font-weight: bold;
        }
        
        .user-list {
            list-style: none;
            padding: 0;
            margin: 10px 0;
            border: 1px solid #ddd;
            border-radius: 5px;
            min-height: 100px;
            background: white;
        }
        
        .user-list li {
            padding: 10px;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .user-actions {
            display: flex;
            gap: 5px;
        }
        
        .edit-btn, .delete-btn {
            background: #FBB740;
            color: white;
            border: none;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            cursor: pointer;
            font-size: 14px;
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
        }
        
        .modal.show {
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        .modal-content {
            background: white;
            padding: 20px;
            border-radius: 10px;
            min-width: 300px;
            text-align: center;
        }
        
        .log-area {
            background: #000;
            color: #0f0;
            padding: 10px;
            border-radius: 5px;
            font-family: monospace;
            height: 200px;
            overflow-y: auto;
            margin: 10px 0;
        }
        
        .bottom-sheet {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.3);
            z-index: 1000;
        }
        
        .bottom-sheet.show {
            display: block;
        }
        
        .bottom-sheet-content {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            background: white;
            border-radius: 20px 20px 0 0;
            transform: translateY(100%);
            transition: transform 0.3s ease;
        }
        
        .bottom-sheet.show .bottom-sheet-content {
            transform: translateY(0);
        }
        
        .bottom-sheet-header {
            padding: 15px 20px;
            border-bottom: 1px solid #ddd;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
    </style>
</head>
<body>
    <div class="debug-container">
        <h1>üêõ Button Debug Tool</h1>
        <p>This tool helps debug the exact button click flow in userAdmin.html</p>
        
        <div class="log-area" id="debugLog"></div>
        
        <div class="step" id="step1">
            <h3>Step 1: Test Profile Icon Click</h3>
            <p>Click the profile icon to open user selection modal:</p>
            <button class="profile-icon" id="profileIcon">üë§</button>
            <span id="step1Status">Not tested</span>
        </div>
        
        <div class="step" id="step2">
            <h3>Step 2: Test Add User Button (inside modal)</h3>
            <p>This button should only work after Step 1:</p>
            <button class="add-user-btn" id="addUserBtn">+</button>
            <span id="step2Status">Not tested</span>
        </div>
        
        <div class="step" id="step3">
            <h3>Step 3: Test Edit/Delete Buttons</h3>
            <p>These buttons are generated dynamically:</p>
            <div class="user-list" id="userList">
                <li>Test User 
                    <div class="user-actions">
                        <button class="edit-btn" onclick="testEdit('Test User')">‚öôÔ∏è</button>
                        <button class="delete-btn" onclick="testDelete('Test User')">‚ùå</button>
                    </div>
                </li>
            </div>
            <span id="step3Status">Not tested</span>
        </div>
        
        <div class="step" id="step4">
            <h3>Step 4: Manual Button Tests</h3>
            <button class="test-button" onclick="testAddModal()">Force Open Add Modal</button>
            <button class="test-button" onclick="testEditModal()">Force Open Edit Modal</button>
            <button class="test-button" onclick="testDeleteModal()">Force Open Delete Modal</button>
            <span id="step4Status">Ready for testing</span>
        </div>
    </div>
    
    <!-- User Selection Modal -->
    <div class="bottom-sheet" id="userSelectModal">
        <div class="bottom-sheet-content">
            <div class="bottom-sheet-header">
                <div>
                    <h3>Add User</h3>
                    <button class="add-user-btn" id="addUserBtnModal">+</button>
                </div>
                <button id="closeModalBtn">‚úï</button>
            </div>
            <ul class="user-list">
                <li>Sample User 1 
                    <div class="user-actions">
                        <button class="edit-btn" onclick="testEdit('Sample User 1')">‚öôÔ∏è</button>
                        <button class="delete-btn" onclick="testDelete('Sample User 1')">‚ùå</button>
                    </div>
                </li>
                <li>Sample User 2 
                    <div class="user-actions">
                        <button class="edit-btn" onclick="testEdit('Sample User 2')">‚öôÔ∏è</button>
                        <button class="delete-btn" onclick="testDelete('Sample User 2')">‚ùå</button>
                    </div>
                </li>
            </ul>
        </div>
    </div>
    
    <!-- Add User Modal -->
    <div class="modal" id="addUserModal">
        <div class="modal-content">
            <h3>Add a Bee</h3>
            <input type="text" id="usernameInput" placeholder="Bee name" style="width: 100%; padding: 10px; margin: 10px 0;" />
            <div>
                <label><input type="radio" name="beeRole" value="Admin"> Parent Bee</label><br>
                <label><input type="radio" name="beeRole" value="User" checked> Child Bee</label>
            </div>
            <p id="errorMessage" style="color: red; display: none;">Please enter a valid name</p>
            <div style="margin-top: 20px;">
                <button id="submitUserBtn" style="background: #FBB740; color: white; padding: 10px 20px; border: none; border-radius: 5px;">Add</button>
                <button id="cancelUserBtn" style="background: #ccc; padding: 10px 20px; border: none; border-radius: 5px;">Cancel</button>
            </div>
        </div>
    </div>
    
    <!-- Edit User Modal -->
    <div class="modal" id="permissionModal">
        <div class="modal-content">
            <h3>Edit Bee</h3>
            <input type="text" id="editUserNameInput" placeholder="Bee name" style="width: 100%; padding: 10px; margin: 10px 0;" />
            <div>
                <label><input type="radio" name="editBeeRole" value="Admin" id="editAdminRole"> Parent Bee</label><br>
                <label><input type="radio" name="editBeeRole" value="User" id="editUserRole"> Child Bee</label>
            </div>
            <p id="editErrorMessage" style="color: red; display: none;">Please enter a valid name</p>
            <div style="margin-top: 20px;">
                <button id="savePermissionBtn" style="background: #FBB740; color: white; padding: 10px 20px; border: none; border-radius: 5px;">Save</button>
                <button id="cancelEditBtn" style="background: #ccc; padding: 10px 20px; border: none; border-radius: 5px;">Cancel</button>
            </div>
        </div>
    </div>
    
    <!-- Delete Confirmation Modal -->
    <div class="modal" id="confirmModal">
        <div class="modal-content" style="background: #2A2B32; color: white;">
            <p>Are you sure you want to delete this user?</p>
            <div style="margin-top: 20px;">
                <button id="confirmYesBtn" style="background: #FBB740; color: black; padding: 10px 20px; border: none; border-radius: 5px;">Yes</button>
                <button id="confirmNoBtn" style="background: #666; color: white; padding: 10px 20px; border: none; border-radius: 5px;">No</button>
            </div>
        </div>
    </div>
    
    <script>
        let stepResults = {
            step1: false,
            step2: false,
            step3: false,
            step4: false
        };
        
        function log(message) {
            const timestamp = new Date().toLocaleTimeString();
            const logArea = document.getElementById('debugLog');
            logArea.innerHTML += `[${timestamp}] ${message}\n`;
            logArea.scrollTop = logArea.scrollHeight;
            console.log(message);
        }
        
        function updateStepStatus(step, status, success = false) {
            const stepEl = document.getElementById(`step${step}`);
            const statusEl = document.getElementById(`step${step}Status`);
            
            statusEl.textContent = status;
            stepEl.className = `step ${success ? 'success' : 'error'}`;
            stepResults[`step${step}`] = success;
        }
        
        // Test functions
        function testEdit(username) {
            log(`üìù Edit button clicked for: ${username}`);
            
            // Test showPermissionModal function
            if (typeof showPermissionModal === 'function') {
                try {
                    showPermissionModal(username);
                    log(`‚úÖ showPermissionModal('${username}') called successfully`);
                    updateStepStatus(3, '‚úÖ Edit function works', true);
                } catch (e) {
                    log(`‚ùå showPermissionModal error: ${e.message}`);
                    updateStepStatus(3, '‚ùå Edit function failed', false);
                }
            } else {
                log(`‚ùå showPermissionModal function not found`);
                
                // Fallback: manually open modal
                const modal = document.getElementById('permissionModal');
                if (modal) {
                    document.getElementById('editUserNameInput').value = username;
                    modal.classList.add('show');
                    log(`‚ö†Ô∏è Manually opened edit modal for ${username}`);
                    updateStepStatus(3, '‚ö†Ô∏è Manual edit works', true);
                } else {
                    log(`‚ùå Edit modal element not found`);
                    updateStepStatus(3, '‚ùå Edit modal missing', false);
                }
            }
        }
        
        function testDelete(username) {
            log(`üóëÔ∏è Delete button clicked for: ${username}`);
            
            // Test showConfirmModal function
            if (typeof showConfirmModal === 'function') {
                try {
                    showConfirmModal(username);
                    log(`‚úÖ showConfirmModal('${username}') called successfully`);
                    updateStepStatus(3, '‚úÖ Delete function works', true);
                } catch (e) {
                    log(`‚ùå showConfirmModal error: ${e.message}`);
                    updateStepStatus(3, '‚ùå Delete function failed', false);
                }
            } else {
                log(`‚ùå showConfirmModal function not found`);
                
                // Fallback: manually open modal
                const modal = document.getElementById('confirmModal');
                if (modal) {
                    modal.classList.add('show');
                    log(`‚ö†Ô∏è Manually opened delete modal for ${username}`);
                    updateStepStatus(3, '‚ö†Ô∏è Manual delete works', true);
                } else {
                    log(`‚ùå Delete modal element not found`);
                    updateStepStatus(3, '‚ùå Delete modal missing', false);
                }
            }
        }
        
        function testAddModal() {
            log(`‚ûï Force opening add modal`);
            const modal = document.getElementById('addUserModal');
            if (modal) {
                document.getElementById('usernameInput').value = '';
                document.querySelector('input[name="beeRole"][value="User"]').checked = true;
                modal.classList.add('show');
                log(`‚úÖ Add modal opened manually`);
                updateStepStatus(4, '‚úÖ Manual add works', true);
            } else {
                log(`‚ùå Add modal element not found`);
                updateStepStatus(4, '‚ùå Add modal missing', false);
            }
        }
        
        function testEditModal() {
            log(`‚öôÔ∏è Force opening edit modal`);
            const modal = document.getElementById('permissionModal');
            if (modal) {
                document.getElementById('editUserNameInput').value = 'Test User';
                document.getElementById('editUserRole').checked = true;
                modal.classList.add('show');
                log(`‚úÖ Edit modal opened manually`);
                updateStepStatus(4, '‚úÖ Manual edit works', true);
            } else {
                log(`‚ùå Edit modal element not found`);
                updateStepStatus(4, '‚ùå Edit modal missing', false);
            }
        }
        
        function testDeleteModal() {
            log(`‚ùå Force opening delete modal`);
            const modal = document.getElementById('confirmModal');
            if (modal) {
                modal.classList.add('show');
                log(`‚úÖ Delete modal opened manually`);
                updateStepStatus(4, '‚úÖ Manual delete works', true);
            } else {
                log(`‚ùå Delete modal element not found`);
                updateStepStatus(4, '‚ùå Delete modal missing', false);
            }
        }
        
        // Event handlers
        document.addEventListener('DOMContentLoaded', function() {
            log('üöÄ Debug tool loaded');
            
            // Test profile icon
            const profileIcon = document.getElementById('profileIcon');
            if (profileIcon) {
                profileIcon.addEventListener('click', function() {
                    log('üë§ Profile icon clicked');
                    const modal = document.getElementById('userSelectModal');
                    if (modal) {
                        modal.classList.add('show');
                        log('‚úÖ User selection modal opened');
                        updateStepStatus(1, '‚úÖ Profile icon works', true);
                        
                        // Test add button inside modal
                        const addBtn = document.getElementById('addUserBtnModal');
                        if (addBtn) {
                            log('‚úÖ Add button found inside modal');
                        } else {
                            log('‚ùå Add button not found inside modal');
                        }
                    } else {
                        log('‚ùå User selection modal not found');
                        updateStepStatus(1, '‚ùå Profile icon failed', false);
                    }
                });
                log('‚úÖ Profile icon event listener attached');
            } else {
                log('‚ùå Profile icon element not found');
                updateStepStatus(1, '‚ùå Profile icon missing', false);
            }
            
            // Test add button (outside modal)
            const addBtn = document.getElementById('addUserBtn');
            if (addBtn) {
                addBtn.addEventListener('click', function() {
                    log('‚ûï Add button (outside modal) clicked');
                    testAddModal();
                    updateStepStatus(2, '‚úÖ Add button works', true);
                });
                log('‚úÖ Add button (outside modal) event listener attached');
            } else {
                log('‚ùå Add button (outside modal) element not found');
                updateStepStatus(2, '‚ùå Add button missing', false);
            }
            
            // Test add button inside modal
            const addBtnModal = document.getElementById('addUserBtnModal');
            if (addBtnModal) {
                addBtnModal.addEventListener('click', function() {
                    log('‚ûï Add button (inside modal) clicked');
                    testAddModal();
                    updateStepStatus(2, '‚úÖ Add button in modal works', true);
                });
                log('‚úÖ Add button (inside modal) event listener attached');
            } else {
                log('‚ùå Add button (inside modal) element not found');
            }
            
            // Close modal handlers
            document.getElementById('closeModalBtn').addEventListener('click', function() {
                document.getElementById('userSelectModal').classList.remove('show');
                log('‚úÖ User selection modal closed');
            });
            
            // Modal close buttons
            document.getElementById('cancelUserBtn').addEventListener('click', function() {
                document.getElementById('addUserModal').classList.remove('show');
                log('‚úÖ Add modal closed');
            });
            
            document.getElementById('cancelEditBtn').addEventListener('click', function() {
                document.getElementById('permissionModal').classList.remove('show');
                log('‚úÖ Edit modal closed');
            });
            
            document.getElementById('confirmNoBtn').addEventListener('click', function() {
                document.getElementById('confirmModal').classList.remove('show');
                log('‚úÖ Delete modal closed');
            });
            
            // Submit buttons
            document.getElementById('submitUserBtn').addEventListener('click', function() {
                const name = document.getElementById('usernameInput').value;
                const role = document.querySelector('input[name="beeRole"]:checked')?.value;
                if (name.trim()) {
                    log(`‚úÖ Add user submitted: ${name} as ${role}`);
                    document.getElementById('addUserModal').classList.remove('show');
                } else {
                    document.getElementById('errorMessage').style.display = 'block';
                    log('‚ö†Ô∏è Add user validation failed');
                }
            });
            
            document.getElementById('savePermissionBtn').addEventListener('click', function() {
                const name = document.getElementById('editUserNameInput').value;
                const role = document.querySelector('input[name="editBeeRole"]:checked')?.value;
                if (name.trim()) {
                    log(`‚úÖ Edit user submitted: ${name} as ${role}`);
                    document.getElementById('permissionModal').classList.remove('show');
                } else {
                    document.getElementById('editErrorMessage').style.display = 'block';
                    log('‚ö†Ô∏è Edit user validation failed');
                }
            });
            
            document.getElementById('confirmYesBtn').addEventListener('click', function() {
                log('‚úÖ Delete confirmed');
                document.getElementById('confirmModal').classList.remove('show');
            });
            
            // Click outside to close
            document.querySelectorAll('.modal').forEach(modal => {
                modal.addEventListener('click', function(e) {
                    if (e.target === modal) {
                        modal.classList.remove('show');
                        log(`‚úÖ Modal closed by clicking outside: ${modal.id}`);
                    }
                });
            });
            
            document.getElementById('userSelectModal').addEventListener('click', function(e) {
                if (e.target === this) {
                    this.classList.remove('show');
                    log('‚úÖ User selection modal closed by clicking outside');
                }
            });
            
            log('üéØ All event listeners attached. Ready for testing!');
        });
        
        // Test timer - check what elements exist after 1 second
        setTimeout(function() {
            log('üîç Element check after 1 second:');
            const elements = [
                'profileIcon',
                'addUserBtn', 
                'addUserBtnModal',
                'userSelectModal',
                'addUserModal',
                'permissionModal',
                'confirmModal'
            ];
            
            elements.forEach(id => {
                const el = document.getElementById(id);
                if (el) {
                    log(`‚úÖ ${id}: Found`);
                } else {
                    log(`‚ùå ${id}: Missing`);
                }
            });
        }, 1000);
    </script>
</body>
</html>